<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
<head>

<title>Sigma - Svg test</title>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>

</head>
<body>

	<svg id="s" xmlns="http://www.w3.org/2000/svg" />

</body>

<script type="text/javascript">
	    
$(document).ready(function(){


		// GLOBALS
		var ww;
	 	var wh;
	 	var main_topic = 'Games programming';
	 	var s;

	 	// MISC functions
		 function updateWwWh(){
		 	ww = window.innerWidth; 
			wh = window.innerHeight;
			console.log('Width: ' + ww + ' Height: ' + wh);
		}
		
	    function makeSVG(tag, attrs) {
	        var el = document.createElementNS('http://www.w3.org/2000/svg', tag);
	        for (var k in attrs)
	            el.setAttribute(k, attrs[k]);
	        return el; 
	    }



	    // INIT function
	    function initSVG(map){

	    	// Update world width and height
	    	updateWwWh();

	    	// LOAD/SET SVG global OBJECT
	    	s = document.getElementById('s');
	    	s.setAttribute('width', ww);
	    	s.setAttribute('height', wh);

	    	// console log
	    	console.log(map);

	    	// Make main node
	    	var main_node = makeSVG('circle', {id: 'main_node', cx: ww/2, cy: wh/2, r: 4, stroke: 'black'});
	    	s.appendChild(main_node);

	    	// Variables
	    	var mnx;           // x and y value of main node
	    	var mny;           // 

	    	var sub_coords = [];// 2d array of xy values ß
	    	var url_coords = [];
	    	var sub_doms = [];
	    	var url_doms = [];

	    	var urlrad;        // radius of url
	    	var subkeys_array; // Array of key names =['subtopic1', 'subtopic2', ..]
	    	var urlkeys_array; //					= ['url1', 'url2', ....]
	    	var subarr_length  // lenght of array
	    	var urlarr_length  // 
	    	var subkey;	       // Single key name = 'subtopic'
	    	var urlkey;        // 				  = 'url'
	    	var subnode;       // DOM SVG circle element
	    	var urlnode;       // 
	    	var i; 			   // counter
	    	var j;			   //

	    	// Get x and y of main nodes
	    	mnx = parseInt(main_node.getAttribute('cx'));
	    	mny = parseInt(main_node.getAttribute('cy'));

	    	// Isolate subtopics, calculate lenght
	    	subkeys_array = Object.keys(map.subtopics);
	    	subarr_length = subkeys_array.length;

	    	function findNodeCoords(bx,by,rx,ry,length){
		    	// Create coordinates of all sub nodes
		    	// input bx, by -- basex, basey
		    	var step = parseInt((2 * Math.PI) / length);
		    	var alpha = 0;
		    	var nx = 0; // new x
		    	var ny = 0;
		    	var coords = [];

		    	for (i=0; i < length; i++){

		    		nx = parseInt(bx + (rx * Math.cos(alpha)));
		    		ny = parseInt(by - (ry * Math.cos(alpha)));

		    		var pair = [nx, ny];
		    		coords.push(pair);

		    		alpha += step;
		    	};
		    	return coords;
		    };
			sub_coords = findNodeCoords(mnx, mny, 200, 100, subarr_length);

	    	// Create Sub node DOM objects

	    	i = 0;
	    	for (xy in sub_coords){
	    		sub_doms[i] = makeSVG('circle', {cx: sub_coords[xy][0], cy: sub_coords[xy][1], r: 4, stroke: 'black'});
	    		s.appendChild(sub_doms[i]);
	    		i++;
	    	};
	    	// --------------------------

	    	// ---- Isolate url-nodes ---- 

	    	for (var i=0; i < subarr_length; i++){

	    		subkey = subkeys_array[i];

	    		urlkeys_array = Object.keys(map.subtopics[subkey]);
	    		urlarr_length = urlkeys_array.length;

	    		var ux = parseInt(sub_doms[i].getAttribute('cx'));
	    		var uy = parseInt(sub_doms[i].getAttribute('cy'));

	    		url_coords[i] = findNodeCoords(ux, uy, 100, 100, urlarr_length);

	    		// Create Url node dom objects
	    		for (var j=0; j< urlarr_length; j++){

	    			console.log('url_coords: ' + url_coords);
	    			console.log(url_coords[0][0][0]);
	    			console.log(url_coords[i][j][0]);

	    			url_doms[i][j] = makeSVG('circle', {cx:url_coords[i][j][0], cy:url_coords[0][0][1], r:4, stroke: 'black'});
	    			s.appendChild(url_doms[i][j]);
	    		};
	    	};
	    	

	    	// End of function
	    	console.log('SVG initialized');
	    };






		function updateSVG(){
			
		};

	    $.post('/getmap', { main_topic : main_topic }, function(data){

	    	if (data.status === 'Getmap OK'){

		    	initSVG(data.map);

		    } else {
		    	console.log(data.status);
		    };

		});
	});



</script>


</html>

<script id="comments" type="text/javascript">
 	

/*

2. Its seems that javascript can access SVG elements the same way as any other element.

1. This link thought me how to use javascript in SVG - http://stackoverflow.com/questions/3642035/jquerys-append-not-working-with-svg-element

links: 
http://www.w3schools.com/svg/svg_circle.asp

*/


 </script>